<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <nav>
    <h1><a href="/">Fruit Store</a></h1>
    <ul>
      <li class="login-ul" style="display: none;">Welcome <span id="user_text"></span></li>
      <li class="login-ul" style="display: none;"><a id="logoutAnchor">Log out</a></li>
      <li class="logout-ul"><a href="api/auth/login">Log in</a></li>
      <li class="logout-ul"><a href="/api/auth/signup" class="btn">Sign up</a></li>
    </ul>
  </nav>

<script>
  const login_ul = document.getElementsByClassName('login-ul')
  const logout_ul = document.getElementsByClassName('logout-ul')

  // auto logout if the token is expired
  if (localStorage.getItem('exp')) {
    if (Date.now() >= localStorage.getItem('exp') * 1000){
      localStorage.clear()
    }
  } 

  if ( localStorage.getItem('username') ) {
    const user = document.getElementById('user_text')
    user.textContent = localStorage.getItem('username')
    login_ul[0].style.display = 'block'
    login_ul[1].style.display = 'block'
    logout_ul[0].style.display = 'none'
    logout_ul[1].style.display = 'none'
  }

  const logoutAnchor = document.getElementById('logoutAnchor')
  logoutAnchor.style.cursor = 'pointer'
  logoutAnchor.addEventListener('click', async (e) => {
    e.preventDefault()
    const res = await fetch('/api/auth/logout', {
      method: 'GET'
    })
    if (res.status === 204) {
      localStorage.clear()
      location.assign('/')
    }
  })
</script>